{% extends "base.html" %}
{% block title %}知识图谱{% endblock %}
{% block content %}
    <div class="container">
        <h1>知识图谱</h1>
        <div class="user-info">
            <h2>您的信息</h2>
            <p><strong>性别：</strong> {{ gender }}</p>
            <p><strong>年龄：</strong> {{ age }}</p>
            <p><strong>感兴趣方向：</strong> {{ direction }}</p>
            <p><strong>兴趣关键词：</strong> {{ keywords|join(' ') }}</p>
        </div>

        <div class="knowledge-graph">
            <h2>兴趣知识图谱</h2>
            <div id="graph" style="width: 100%; height: 600px;"></div>
        </div>
    </div>

    <style type="text/css">
        .container { max-width: 1200px; margin: 40px auto; padding: 30px; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); }
        h1 { color: #2c3e50; text-align: center; margin-bottom: 30px; }
        .user-info { background-color: #f9fafc; padding: 20px; border-radius: 8px; margin-bottom: 30px; border: 1px solid #e0e6ed; }
        .user-info h2 { font-size: 20px; color: #34495e; margin: 0 0 15px; }
        .user-info p { margin: 10px 0; color: #555; }
        .knowledge-graph { margin-top: 30px; }
        .knowledge-graph h2 { font-size: 20px; color: #34495e; margin: 0 0 20px; }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <script type="text/javascript">
        var myChart = echarts.init(document.getElementById('graph'));
        var nodes = {{ nodes|tojson }};
        var links = {{ links|tojson }};

        var option = {
            title: { text: '兴趣知识图谱', left: 'center', textStyle: { color: '#34495e' } },
            tooltip: {},
            series: [{
                type: 'graph',
                layout: 'force',
                data: nodes,
                links: links,
                roam: true,
                label: { show: true, position: 'right', formatter: '{b}' },
                force: { 
                    repulsion: 300,  // 增大斥力，避免节点黏在一起
                    edgeLength: 100, // 增大边长，扩展图谱
                    gravity: 0.1     // 轻微重力，使布局更稳定
                },
                edgeSymbol: ['none', 'arrow'],
                edgeSymbolSize: 10,
                lineStyle: { color: '#3498db', width: 2 },
                itemStyle: { color: '#3498db' }
            }]
        };
        myChart.setOption(option);
        
        // 添加点击事件监听
        myChart.on('click', function(params) {
            if(params.dataType === 'node') {
                var keyword = encodeURIComponent(params.data.keyword || params.data.name);
                window.open('https://so.csdn.net/so/search?q=' + keyword, '_blank');
            }
        });
    </script>
{% endblock %}